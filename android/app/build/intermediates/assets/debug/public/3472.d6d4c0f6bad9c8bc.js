"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3472],{3472:(C,p,h)=>{h.r(p),h.d(p,{GenericOAuth2Web:()=>b});var w=h(467),E=h(5083);class d{static getAppId(t){return this.getOverwritableValue(t,"appId")}static getOverwritableValue(t,e){let n=t[e];return t.web&&e in t.web&&(n=t.web[e]),n}static getAuthorizationUrl(t){let e=t.authorizationBaseUrl+"?client_id="+t.appId;if(e+="&response_type="+t.responseType,t.redirectUrl&&(e+="&redirect_uri="+t.redirectUrl),t.scope&&(e+="&scope="+t.scope),e+="&state="+t.state,t.additionalParameters)for(const n in t.additionalParameters)e+="&"+n+"="+t.additionalParameters[n];return t.pkceCodeChallenge&&(e+="&code_challenge="+t.pkceCodeChallenge,e+="&code_challenge_method="+t.pkceCodeChallengeMethod),encodeURI(e)}static getTokenEndpointData(t,e){let n="";return n+=encodeURIComponent("grant_type")+"="+encodeURIComponent("authorization_code")+"&",n+=encodeURIComponent("client_id")+"="+encodeURIComponent(t.appId)+"&",n+=encodeURIComponent("redirect_uri")+"="+encodeURIComponent(t.redirectUrl)+"&",n+=encodeURIComponent("code")+"="+encodeURIComponent(e)+"&",n+=encodeURIComponent("code_verifier")+"="+encodeURIComponent(t.pkceCodeVerifier),n}static setCodeVerifier(t){try{return window.sessionStorage.setItem("I_Capacitor_GenericOAuth2Plugin_PKCE",t),!0}catch{return!1}}static clearCodeVerifier(){window.sessionStorage.removeItem("I_Capacitor_GenericOAuth2Plugin_PKCE")}static getCodeVerifier(){return window.sessionStorage.getItem("I_Capacitor_GenericOAuth2Plugin_PKCE")}static getUrlParams(t){const e=`${null!=t?t:""}`.trim();if(0===e.length)return;const n=new URL(e);if(!n.search&&!n.hash)return;let r;return r=n.search?n.search.substr(1):n.hash.substr(1),r.split("&").reduce((i,s)=>{const[a,l]=s.split("=");if(a&&a.length>0)return Object.assign(Object.assign({},i),{[a]:decodeURIComponent(l)})},{})}static randomString(t=10){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";let n;if(window.crypto){let r=new Uint32Array(t);window.crypto.getRandomValues(r),r=r.map(i=>e.charCodeAt(i%64));const o=[];r.forEach(i=>{o.push(e.charAt(i%64))}),n=o.join("")}else{n="";for(let r=0;r<t;r++)n+=e.charAt(Math.floor(64*Math.random()))}return n}static buildWebOptions(t){var e=this;return(0,w.A)(function*(){var n;const r=new g;if(r.appId=e.getAppId(t),r.authorizationBaseUrl=e.getOverwritableValue(t,"authorizationBaseUrl"),r.responseType=e.getOverwritableValue(t,"responseType"),r.responseType||(r.responseType="token"),r.redirectUrl=e.getOverwritableValue(t,"redirectUrl"),r.resourceUrl=e.getOverwritableValue(t,"resourceUrl"),r.accessTokenEndpoint=e.getOverwritableValue(t,"accessTokenEndpoint"),r.pkceEnabled=e.getOverwritableValue(t,"pkceEnabled"),r.sendCacheControlHeader=null!==(n=e.getOverwritableValue(t,"sendCacheControlHeader"))&&void 0!==n?n:r.sendCacheControlHeader,r.pkceEnabled){const s=e.getCodeVerifier();s?r.pkceCodeVerifier=s:(r.pkceCodeVerifier=e.randomString(64),e.setCodeVerifier(r.pkceCodeVerifier)),u.HAS_SUBTLE_CRYPTO?yield u.deriveChallenge(r.pkceCodeVerifier).then(a=>{r.pkceCodeChallenge=a,r.pkceCodeChallengeMethod="S256"}):(r.pkceCodeChallenge=r.pkceCodeVerifier,r.pkceCodeChallengeMethod="plain")}r.scope=e.getOverwritableValue(t,"scope"),r.state=e.getOverwritableValue(t,"state"),(!r.state||0===r.state.length)&&(r.state=e.randomString(20));const o=e.getOverwritableValue(t,"additionalParameters");if(o){r.additionalParameters={};for(const s in o)if(s&&s.trim().length>0){const a=o[s];a&&a.trim().length>0&&(r.additionalParameters[s]=a)}}const i=e.getOverwritableValue(t,"additionalResourceHeaders");if(i){r.additionalResourceHeaders={};for(const s in i)if(s&&s.trim().length>0){const a=i[s];a&&a.trim().length>0&&(r.additionalResourceHeaders[s]=a)}}return r.logsEnabled=e.getOverwritableValue(t,"logsEnabled"),r})()}static buildWindowOptions(t){const e=new g;return t.web&&(t.web.windowOptions&&(e.windowOptions=t.web.windowOptions),t.web.windowTarget&&(e.windowTarget=t.web.windowTarget)),e}}class u{static toUint8Array(t){const e=new ArrayBuffer(t.length),n=new Uint8Array(e);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}static toBase64Url(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}static toBase64(t){const e=t.length;let n="";for(let r=0;r<e;r+=3)n+=this.BASE64_CHARS[t[r]>>2],n+=this.BASE64_CHARS[(3&t[r])<<4|t[r+1]>>4],n+=this.BASE64_CHARS[(15&t[r+1])<<2|t[r+2]>>6],n+=this.BASE64_CHARS[63&t[r+2]];return e%3==2?n=n.substring(0,n.length-1)+"=":e%3==1&&(n=n.substring(0,n.length-2)+"=="),n}static deriveChallenge(t){return t.length<43||t.length>128?Promise.reject(new Error("ERR_PKCE_CODE_VERIFIER_INVALID_LENGTH")):u.HAS_SUBTLE_CRYPTO?new Promise((e,n)=>{crypto.subtle.digest("SHA-256",this.toUint8Array(t)).then(r=>e(this.toBase64Url(this.toBase64(new Uint8Array(r)))),r=>n(r))}):Promise.reject(new Error("ERR_PKCE_CRYPTO_NOTSUPPORTED"))}}u.BASE64_CHARS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u.HAS_SUBTLE_CRYPTO=typeof window<"u"&&!!window.crypto&&!!window.crypto.subtle;class g{constructor(){this.sendCacheControlHeader=!0,this.windowTarget="_blank"}}class b extends E.E_{constructor(){super(...arguments),this.loopCount=2e3,this.intervalLength=100,this.MSG_RETURNED_TO_JS="Returned to JS:"}refreshToken(t){return(0,w.A)(function*(){return new Promise((e,n)=>{n(new Error("Functionality not implemented for PWAs yet"))})})()}redirectFlowCodeListener(t){var e=this;return(0,w.A)(function*(){return e.webOptions=yield d.buildWebOptions(t),new Promise((n,r)=>{const o=d.getUrlParams(t.response_url);if(o){const i=o.code;i?e.getAccessToken(o,n,r,i):r(new Error("Oauth Code parameter was not present in url."))}else r(new Error("Oauth Parameters where not present in url."))})})()}authenticate(t){var e=this;return(0,w.A)(function*(){const n=d.buildWindowOptions(t);return e.windowHandle=window.open("",n.windowTarget,n.windowOptions),e.webOptions=yield d.buildWebOptions(t),new Promise((r,o)=>{if(e.webOptions.appId&&0!=e.webOptions.appId.length)if(e.webOptions.authorizationBaseUrl&&0!=e.webOptions.authorizationBaseUrl.length)if(e.webOptions.redirectUrl&&0!=e.webOptions.redirectUrl.length)if(e.webOptions.responseType&&0!=e.webOptions.responseType.length){let i=e.loopCount;e.windowClosedByPlugin=!1;const s=d.getAuthorizationUrl(e.webOptions);e.webOptions.logsEnabled&&e.doLog("Authorization url: "+s),e.windowHandle&&(e.windowHandle.location.href=s),e.intervalId=window.setInterval(()=>{var a;if(i--<0)e.closeWindow();else if(null!==(a=e.windowHandle)&&void 0!==a&&a.closed&&!e.windowClosedByPlugin)window.clearInterval(e.intervalId),o(new Error("USER_CANCELLED"));else{let l;try{l=e.windowHandle.location.href}catch{}if(null!=l&&l.indexOf(e.webOptions.redirectUrl)>=0){e.webOptions.logsEnabled&&e.doLog("Url from Provider: "+l);const c=d.getUrlParams(l);if(c)if(e.webOptions.logsEnabled&&e.doLog("Authorization response:",c),window.clearInterval(e.intervalId),c.state===e.webOptions.state)if(e.webOptions.accessTokenEndpoint){const R=c.code;R?e.getAccessToken(c,r,o,R):o(new Error("ERR_NO_AUTHORIZATION_CODE")),e.closeWindow()}else e.requestResource(c.access_token,r,o,c);else e.webOptions.logsEnabled&&(e.doLog("State from web options: "+e.webOptions.state),e.doLog("State returned from provider: "+c.state)),o(new Error("ERR_STATES_NOT_MATCH")),e.closeWindow()}}},e.intervalLength)}else o(new Error("ERR_PARAM_NO_RESPONSE_TYPE"));else o(new Error("ERR_PARAM_NO_REDIRECT_URL"));else o(new Error("ERR_PARAM_NO_AUTHORIZATION_BASE_URL"));else o(new Error("ERR_PARAM_NO_APP_ID"))})})()}getAccessToken(t,e,n,r){const o=new XMLHttpRequest;o.onload=()=>{if(d.clearCodeVerifier(),200===o.status){const i=JSON.parse(o.response);this.webOptions.logsEnabled&&this.doLog("Access token response:",i),this.requestResource(i.access_token,e,n,t,i)}},o.onerror=()=>{this.doLog("ERR_GENERAL: See client logs. It might be CORS. Status text: "+o.statusText),n(new Error("ERR_GENERAL"))},o.open("POST",this.webOptions.accessTokenEndpoint,!0),o.setRequestHeader("accept","application/json"),this.webOptions.sendCacheControlHeader&&o.setRequestHeader("cache-control","no-cache"),o.setRequestHeader("content-type","application/x-www-form-urlencoded"),o.send(d.getTokenEndpointData(this.webOptions,r))}requestResource(t,e,n,r,o=null){if(this.webOptions.resourceUrl){const i=this.webOptions.logsEnabled;if(i&&this.doLog("Resource url: "+this.webOptions.resourceUrl),t){i&&this.doLog("Access token:",t);const s=this,a=new XMLHttpRequest;if(a.onload=function(){if(200===this.status){const l=JSON.parse(this.response);i&&s.doLog("Resource response:",l),l&&s.assignResponses(l,t,r,o),i&&s.doLog(s.MSG_RETURNED_TO_JS,l),e(l)}else n(new Error(this.statusText));s.closeWindow()},a.onerror=function(){i&&s.doLog("ERR_GENERAL: "+this.statusText),n(new Error("ERR_GENERAL")),s.closeWindow()},a.open("GET",this.webOptions.resourceUrl,!0),a.setRequestHeader("Authorization",`Bearer ${t}`),this.webOptions.additionalResourceHeaders)for(const l in this.webOptions.additionalResourceHeaders)a.setRequestHeader(l,this.webOptions.additionalResourceHeaders[l]);a.send()}else i&&this.doLog("No accessToken was provided although you configured a resourceUrl. Remove the resourceUrl from the config."),n(new Error("ERR_NO_ACCESS_TOKEN")),this.closeWindow()}else{const i={};this.assignResponses(i,t,r,o),this.webOptions.logsEnabled&&this.doLog(this.MSG_RETURNED_TO_JS,i),e(i),this.closeWindow()}}assignResponses(t,e,n,r=null){n&&(t.authorization_response=n),r&&(t.access_token_response=r),t.access_token=e}logout(t){return(0,w.A)(function*(){return new Promise((e,n)=>{localStorage.removeItem(d.getAppId(t)),e(!0)})})()}closeWindow(){var t;window.clearInterval(this.intervalId),null===(t=this.windowHandle)||void 0===t||t.close(),this.windowClosedByPlugin=!0}doLog(t,e=null){console.log("I/Capacitor/GenericOAuth2Plugin: "+t,e)}}}}]);